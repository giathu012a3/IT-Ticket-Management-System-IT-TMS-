{% extends "base.html" %}

{% block title %}Yêu cầu của tôi - TicketSys{% endblock %}

{% block content %}
<div class="mb-6 flex items-center justify-between">
    <div>
        <h2 class="text-2xl font-bold dark:text-white tracking-tight">Tổng quan Yêu cầu</h2>
        <p class="text-slate-500 dark:text-slate-400 text-sm">Thống kê tình trạng các yêu cầu hỗ trợ của bạn.</p>
    </div>
    <div class="flex gap-3">
        <a href="{{ url_for('user.user_tickets') }}"
            class="bg-white dark:bg-[#283039] hover:bg-slate-50 dark:hover:bg-[#3b4754] text-slate-700 dark:text-white border border-slate-200 dark:border-slate-700 px-4 py-2.5 rounded-lg text-sm font-bold flex items-center gap-2 transition-all">
            <span class="material-symbols-outlined text-lg">list</span>
            Danh sách
        </a>
        <a href="{{ url_for('user.create_ticket') }}"
            class="bg-primary hover:bg-primary/90 text-white px-4 py-2.5 rounded-lg text-sm font-bold flex items-center gap-2 transition-all shadow-lg shadow-primary/20">
            <span class="material-symbols-outlined text-lg">add_circle</span>
            Tạo mới
        </a>
    </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
    <!-- Summary Cards -->
    <div class="space-y-6">
        <div class="bg-white dark:bg-[#111418] p-6 rounded-xl border border-slate-200 dark:border-[#3b4754] shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest">Tổng số yêu cầu</h3>
                <span class="material-symbols-outlined text-blue-500">confirmation_number</span>
            </div>
            <p class="text-4xl font-bold text-slate-900 dark:text-white">{{ total_tickets }}</p>
        </div>

        <div class="bg-white dark:bg-[#111418] p-6 rounded-xl border border-slate-200 dark:border-[#3b4754] shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest">Đang xử lý</h3>
                <span class="material-symbols-outlined text-amber-500">pending</span>
            </div>
            {% set active_count = total_tickets - status_counts.get('Resolved', 0) - status_counts.get('Closed', 0) %}
            <p class="text-4xl font-bold text-slate-900 dark:text-white">{{ active_count }}</p>
            <p class="text-xs text-slate-400 mt-1">Yêu cầu chưa hoàn thành</p>
        </div>
    </div>

    <!-- Chart -->
    <div class="bg-white dark:bg-[#111418] p-6 rounded-xl border border-slate-200 dark:border-[#3b4754] shadow-sm">
        <h3 class="text-sm font-bold dark:text-white mb-6">Trạng thái Yêu cầu</h3>
        <div class="w-full h-64 relative">
            <canvas id="statusChart"></canvas>
        </div>
    </div>
</div>

<script>
    const statusData = {{ status_counts | tojson }};

    Chart.defaults.color = '#64748b';
    Chart.defaults.font.family = 'Inter';

    new Chart(document.getElementById('statusChart'), {
        type: 'doughnut',
        data: {
            labels: Object.keys(statusData),
            datasets: [{
                data: Object.values(statusData),
                backgroundColor: ['#3b82f6', '#6366f1', '#f59e0b', '#a855f7', '#10b981', '#64748b'],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'right', labels: { usePointStyle: true } }
            }
        }
    });
</script>
{% endblock %}